<!DOCTYPE html>
<html lang="no">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Grunnleggende HTML-sideoppsett" />
    <title>Velkommen</title>
    <link rel="stylesheet" href="css/styles.css" />
    <!-- Lokale stiler flyttet til css/styles.css -->
    <link rel="icon" href="data:," />
  </head>
  <body>
    <div class="container-main" style="border: 1px solid darkgrey">
      <div
        class="section-rows logo-wrapper"
        style="background-color: #efefef; border: solid 0px red"
      >
        <img
          src="images/KinnarpsLogo.png"
          alt="Default logo"
          style="max-height: 44px; max-width: 240px"
        />
      </div>

      <!-- Question section -->
      <div class="section-rows fixed-height" style="border: solid 0px red">
        <p class="instructions-text">
          Hvor enig er du i at (klikk "Hopp over" hvis ikke opplevd) ...
        </p>
        <div class="scroll-container question-wrapper">
          <p class="question-text">
            Hvis det skulle være aktuelt, hvor sannsynlig er det at du vil
            anbefale denne virksomheten til familie, venner og kjente? Det er
            hyggelig om du gjør det altså .....
          </p>
        </div>
      </div>

      <!-- Response options section -->
      <div
        class="section-columns many-options"
        style="
          flex: 0 1 auto;
          height: 520px;
          display: flex;
          border: solid 0px red;
        "
      >
        <div
          class="sub-section"
          style="flex: 1; font-size: 1rem; text-align: center"
        >
          <ul style="list-style: none; margin: 0; padding: 0; width: 100%">
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
                type="button"
              >
                <span>Svartekst 0</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
              >
                <span>Svartekst 1</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
              >
                <span>Svartekst 2</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
              >
                <span>Svartekst 3</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
              >
                <span>Svartekst 4</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
              >
                <span>Svartekst 5</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
              >
                <span>Svartekst 6</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
              >
                <span>Svartekst 7</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
              >
                <span>Svartekst 8</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
              >
                <span>Svartekst 9</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
            <li class="li-optionrow">
              <span class="priority-number"></span>
              <button
                class="button-optiontext selected"
                style="background-color: darkgreen"
                type="button"
              >
                <span>Svartekst 10</span>
              </button>
              <span class="invisible-teller">100</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- Navigation section with navigation buttons -->
      <div class="section-columns" style="flex: 0 1 auto">
        <div class="sub-section" style="justify-content: flex-start">
          <button
            id="skip"
            class="button-progress"
            type="button"
            aria-pressed="false"
            aria-label="Hopp over spørsmål"
          >
            Hopp over
          </button>
        </div>
        <div
          class="sub-section"
          style="justify-content: center; text-align: center; width: 100%"
        >
          <div class="progress-container">
            <progress
              id="surveyProgress"
              value="0"
              max="100"
              data-page="3"
              data-total="8"
              aria-label="Spørreundersøkelses fremdrift"
            ></progress>
          </div>
        </div>
        <div class="sub-section" style="justify-content: flex-end">
          <button id="nextButton" class="button-progress">Neste m/JS</button>
        </div>
      </div>

      <!-- Footer -->
      <div
        class="section-columns"
        style="
          flex: 0 1 auto;
          border-bottom: 0px solid lightgrey;
          font-size: 0.8rem;
        "
      >
        <div class="sub-section" style="justify-content: center">
          <a
            href="https://excellerate.no"
            target="_blank"
            rel="noopener noreferrer"
          >
            Avmelding
          </a>
        </div>
        <div class="sub-section" style="justify-content: center">
          <a
            href="https://excellerate.no"
            target="_blank"
            rel="noopener noreferrer"
          >
            Personvern
          </a>
        </div>
      </div>
    </div>
  </body>

  <script>
    // Init: tilgjengelighet, knapp-typer, toggle for skip-knapp og progress-logikk
    document.addEventListener("DOMContentLoaded", function () {
      // Sikre at alle svar-knapper er type=button og har aria-label
      document.querySelectorAll(".button-optiontext").forEach(function (btn) {
        if (!btn.hasAttribute("type")) btn.setAttribute("type", "button");
        const text = (btn.textContent || btn.innerText || "").trim();
        if (text && !btn.hasAttribute("aria-label"))
          btn.setAttribute("aria-label", text);
        if (!btn.hasAttribute("tabindex")) btn.setAttribute("tabindex", "0");
      });

      // Toggle-funksjon for "Hopp over"
      const skipBtn = document.getElementById("skip");
      function toggleSkip() {
        const pressed = skipBtn.getAttribute("aria-pressed") === "true";
        skipBtn.setAttribute("aria-pressed", String(!pressed));
        skipBtn.classList.toggle("active-skip", !pressed);
      }
      skipBtn.addEventListener("click", toggleSkip);

      // Initialiser progressbaren fra data-attributter
      const prog = document.getElementById("surveyProgress");
      const pageNo = parseInt(prog.getAttribute("data-page")) || 0;
      const total = parseInt(prog.getAttribute("data-total")) || 1;
      updateProgressBar(pageNo, total);
    });

    function updateProgressBar(pageNo, totalPages) {
      const progressBar = document.getElementById("surveyProgress");
      if (!progressBar) return;
      const fraction = Math.max(0, Math.min(1, pageNo / totalPages));
      const percent = Math.round(fraction * 100);
      progressBar.value = percent;
      progressBar.setAttribute("aria-valuenow", String(percent));
      progressBar.setAttribute("title", percent + "% fullført");
    }
  </script>
  <script>
    // Fade out question and response sections when clicking "Neste"
    (function () {
      function attachFadeHandler() {
        const nextBtn = document.getElementById("nextButton");
        const fadeTargets = document.querySelectorAll(
          ".section-rows.fixed-height, .section-columns.many-options"
        );

        if (nextBtn) {
          nextBtn.addEventListener("click", function () {
            // Oppdater progress først
            const prog = document.getElementById("surveyProgress");
            if (prog) {
              const pageNo = parseInt(prog.getAttribute("data-page")) || 0;
              const total = parseInt(prog.getAttribute("data-total")) || 1;
              if (pageNo < total) {
                const nextPage = pageNo + 1;
                prog.setAttribute("data-page", String(nextPage));
                updateProgressBar(nextPage, total);
              }
            }

            // Start fade and hide when transition ends
            fadeTargets.forEach((el) => {
              el.classList.add("fade-out");
              const onEnd = function (ev) {
                if (ev.propertyName === "opacity") {
                  el.style.display = "none";
                  el.removeEventListener("transitionend", onEnd);
                }
              };
              el.addEventListener("transitionend", onEnd);
            });
          });
        }
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", attachFadeHandler);
      } else {
        attachFadeHandler();
      }
    })();
  </script>
</html>
